<div class="revision-history-container">
    <mat-card class="auth-card">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>lock</mat-icon>
                Airtable Authentication
            </mat-card-title>
        </mat-card-header>

        <mat-card-content>
            <div *ngIf="!isAuthenticated">
                <form [formGroup]="authForm" (ngSubmit)="authenticate()">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Email</mat-label>
                        <input matInput type="email" formControlName="email" placeholder="your@email.com">
                        <mat-icon matPrefix>email</mat-icon>
                        <mat-error *ngIf="authForm.get('email')?.hasError('required')">
                            Email is required
                        </mat-error>
                        <mat-error *ngIf="authForm.get('email')?.hasError('email')">
                            Invalid email format
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Password</mat-label>
                        <input matInput type="password" formControlName="password" placeholder="••••••••">
                        <mat-icon matPrefix>vpn_key</mat-icon>
                        <mat-error *ngIf="authForm.get('password')?.hasError('required')">
                            Password is required
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width" *ngIf="showMfaInput">
                        <mat-label>MFA Code</mat-label>
                        <input matInput formControlName="mfaCode" placeholder="123456" maxlength="6">
                        <mat-icon matPrefix>security</mat-icon>
                    </mat-form-field>

                    <button mat-raised-button color="primary" type="submit" [disabled]="authForm.invalid || isLoading"
                        class="full-width">
                        <mat-icon *ngIf="!isLoading">login</mat-icon>
                        <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
                        {{ isLoading ? 'Authenticating...' : 'Authenticate' }}
                    </button>
                </form>
            </div>

            <div *ngIf="isAuthenticated" class="authenticated-state">
                <div class="status-badge">
                    <mat-icon color="primary">check_circle</mat-icon>
                    <span>Authenticated</span>
                </div>
                <button mat-stroked-button color="warn" (click)="logout()">
                    <mat-icon>logout</mat-icon>
                    Logout
                </button>
            </div>
        </mat-card-content>
    </mat-card>

    <mat-card class="scrape-card" *ngIf="isAuthenticated">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>history</mat-icon>
                Fetch Revision History
            </mat-card-title>
        </mat-card-header>

        <mat-card-content>
            <form [formGroup]="scrapeForm" (ngSubmit)="fetchRevisionHistory()">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Base ID</mat-label>
                    <input matInput formControlName="baseId" placeholder="appXXXXXXXXXXXXXX">
                    <mat-icon matPrefix>folder</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Table ID</mat-label>
                    <input matInput formControlName="tableId" placeholder="tblXXXXXXXXXXXXXX">
                    <mat-icon matPrefix>table_chart</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Record IDs (comma-separated)</mat-label>
                    <textarea matInput formControlName="recordIds" placeholder="recXXXXXXXXXXXXXX, recYYYYYYYYYYYYYY"
                        rows="4"></textarea>
                    <mat-icon matPrefix>list</mat-icon>
                    <mat-hint>Enter record IDs separated by commas</mat-hint>
                </mat-form-field>

                <button mat-raised-button color="accent" type="submit" [disabled]="scrapeForm.invalid || isLoading"
                    class="full-width">
                    <mat-icon *ngIf="!isLoading">cloud_download</mat-icon>
                    <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
                    {{ isLoading ? 'Fetching...' : 'Fetch Revision History' }}
                </button>
            </form>
        </mat-card-content>
    </mat-card>

    <mat-card class="grid-card" *ngIf="rowData.length > 0">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>analytics</mat-icon>
                Revision History ({{ rowData.length }} records)
            </mat-card-title>
        </mat-card-header>

        <mat-card-content>
            <ag-grid-angular style="width: 100%; height: 500px;" class="ag-theme-material" [columnDefs]="columnDefs"
                [rowData]="rowData" [defaultColDef]="defaultColDef" [pagination]="true" [paginationPageSize]="20"
                [animateRows]="true">
            </ag-grid-angular>
        </mat-card-content>
    </mat-card>
</div>